---

# opening worker ports
- name: firewall configuration1 for master
  firewalld:
    port: "{{ item }}"
    zone: public
    permanent: yes
    state: enabled
  become: true
  with_items:
   - 10250/tcp
   - 30000-32767/tcp

- name: Creating a file with content
  copy:
    dest: "/home/ansible/token2.sh"
    content: "{{ hostvars['DUMMY_HOST']['PLAY1VAR_NEW'] }}"
  become: yes

- name: Echo the output token file vaule
  shell: sed 's/\\//g' /home/ansible/token2.sh 
  register: kubeadmExit

- debug: msg=" {{ kubeadmExit.stdout }}"

- name: images config
  command: "{{kubeadmExit.stdout}} --ignore-preflight-errors=all"
  become: yes

# Reload config.
- firewalld:
    masquerade: yes
    state: enabled
    permanent: yes
  become: yes

# Get nodes
- name: get nodes
  command: kubectl get nodes
  become: yes

- lineinfile:
    path: /etc/apt/sources.list
    regexp: '\-updates main'
    state: absent
    backup: yes